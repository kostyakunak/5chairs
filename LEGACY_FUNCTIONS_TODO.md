# LEGACY_FUNCTIONS_TODO.md

## Восстановить бизнес-логику для следующих функций (после перехода на meetings/applications)

---

### 1. get_application(app_id)
- **Назначение:** Получить заявку по id.
- **Старая логика:** Использовала events/event_applications для поиска заявки пользователя на событие.
- **Что реализовать:** Теперь искать заявку в таблице applications по app_id. Если нужно — подтягивать связанные данные (user, timeslot, meeting).

---

### 2. update_application_status(app_id, status, note=None)
- **Назначение:** Обновить статус заявки (и/или добавить заметку).
- **Старая логика:** Обновляла статус в event_applications, могла менять статус пользователя.
- **Что реализовать:** Теперь обновлять статус в applications, при необходимости — добавлять заметку. Возможно, триггерить уведомления.

---

### 3. get_users_by_time_preference(time_slot_id)
- **Назначение:** Получить пользователей, подходящих по временному слоту.
- **Старая логика:** Через event_applications выбирала пользователей, подавших заявки на event с нужным time_slot_id.
- **Что реализовать:** Теперь искать пользователей по заявкам в applications, где time_slot_id совпадает.
- **Текущее состояние:** Реализована как заглушка (возвращает пустой список) для совместимости и запуска бота. Требует полноценной реализации.

---

### 4. get_compatible_users_for_meeting(meeting_id)
- **Назначение:** Получить пользователей, которых можно добавить во встречу.
- **Старая логика:** Через event_applications и events фильтровала пользователей по совместимости (например, не добавленных в другие встречи, с подходящим статусом и т.д.).
- **Что реализовать:** Теперь фильтровать по applications и meeting_members, исключая уже добавленных, с нужным статусом и т.д.
- **Текущее состояние:** Реализована как заглушка (возвращает пустой список) для совместимости и запуска бота. Требует полноценной реализации.

---

### 5. get_user_application(user_id)
- **Назначение:** Получить заявку пользователя.
- **Старая логика:** Через event_applications искала заявку пользователя на событие.
- **Что реализовать:** Теперь искать заявку в applications по user_id, возможно с фильтрацией по статусу/слоту/городу.
- **Текущее состояние:** Реализована базовая версия (выбирает первую подходящую заявку), требуется полноценная реализация с поддержкой фильтрации и возвратом всех заявок пользователя.

---

### 6. get_available_dates_with_users_count(city_id, time_slot_id)
- **Назначение:** Получить список доступных дат для города и временного слота с количеством пользователей на каждую дату.
- **Старая логика:** Через events/event_applications считала количество заявок на каждую дату/слот.
- **Что реализовать:** Теперь агрегировать данные по applications (и, возможно, available_dates), группируя по дате и time_slot_id, считать количество пользователей для каждой даты.
- **Текущее состояние:** Реализована как заглушка (возвращает пустой список) для совместимости и запуска бота. Требует полноценной реализации.

---

### 7. create_meeting_from_available_date(date, time_slot_id, city_id, venue_id, created_by=None)
- **Назначение:** Создать встречу на основе выбранной доступной даты, временного слота, города и площадки.
- **Старая логика:** Создавала event и связывала с event_applications, назначала пользователей и площадку.
- **Что реализовать:** Теперь создавать запись в meetings с нужными параметрами, связывать с time_slots, venue, city, добавлять участников (meeting_members) и инициатора (created_by).
- **Текущее состояние:** Реализована как заглушка (возвращает None) для совместимости и запуска бота. Требует полноценной реализации.

---

### 8. get_pending_applications()
- **Назначение:** Получить список заявок со статусом 'pending' (на рассмотрении).
- **Старая логика:** Искала заявки в event_applications/events со статусом 'pending'.
- **Что реализовать:** Теперь выбирать заявки из applications, где status = 'pending'. При необходимости — подтягивать связанные данные (user, timeslot, city и т.д.).

---

> **Примечание:**
> Все функции должны работать только с актуальными сущностями: applications, meetings, time_slots, users, meeting_members и т.д. Не использовать events/event_applications! 